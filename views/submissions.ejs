<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Submissions</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input[type="text"] { padding: 6px; width: 300px; }
    button { padding: 6px 10px; margin: 5px 2px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; vertical-align: top; }
    th { background-color: #f2f2f2; }
    .delete-button { color: red; cursor: pointer; border: none; background: none; }
    td { max-width: 250px; word-wrap: break-word; }
  </style>
</head>
<body>

<h1>All Verifications</h1>

<form method="GET" action="/submissions">
    <input type="text" name="search" placeholder="Search by employee or company" value="<%= search %>" />
    <button type="submit">Search</button>
    <button type="button" onclick="exportCSV()">Export CSV</button>
</form>

<table id="data-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Requesting Company</th>
      <th>Your Name</th>
      <th>Your Title</th>
      <th>Your Email</th>
      <th>Request Date</th>
      <th>Employee Name</th>
      <th>Employee DOB</th>
      <th>Position Applied</th>
      <th>Previous Company</th>
      <th>Prev. Contact</th>
      <th>Prev. Address</th>
      <th>Employment Start</th>
      <th>Employment End</th>
      <th>Position Held</th>
      <th>Salary at Departure</th>
      <th>Reason for Leaving</th>
      <th>Eligible for Rehire</th>
      <th>Performance Comments</th>
      <th>Additional Comments</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody>
    <% data.forEach(row => { %>
      <tr>
        <td><%= row.id %></td>
        <td><%= row.RequestingCompanyName %></td>
        <td><%= row.YourName %></td>
        <td><%= row.YourTitle %></td>
        <td><%= row.YourEmail %></td>
        <td><%= row.RequestDate?.toISOString().slice(0, 10) %></td>
        <td><%= row.EmployeeFullName %></td>
        <td><%= row.EmployeeDOB?.toISOString().slice(0, 10) %></td>
        <td><%= row.EmployeePositionApplied %></td>
        <td><%= row.PreviousCompanyName %></td>
        <td><%= row.PreviousCompanyContact %></td>
        <td><%= row.PreviousCompanyAddress %></td>
        <td><%= row.EmploymentStartDate?.toISOString().slice(0, 10) %></td>
        <td><%= row.EmploymentEndDate?.toISOString().slice(0, 10) %></td>
        <td><%= row.PositionHeld %></td>
        <td><%= row.SalaryAtDeparture %></td>
        <td><%= row.ReasonForLeaving %></td>
        <td><%= row.EligibleForRehire %></td>
        <td><%= row.PerformanceComments %></td>
        <td><%= row.AdditionalComments %></td>
        <td>
          <form method="POST" action="/delete/<%= row.id %>" onsubmit="return confirm('Are you sure you want to delete this?');">
            <button class="delete-button" type="submit">üóëÔ∏è</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<script>
  function exportCSV() {
    const table = document.getElementById("data-table");
    let csv = [];
    for (let row of table.rows) {
      let cols = [...row.cells].slice(0, -1).map(cell => `"${cell.innerText.replace(/"/g, '""')}"`);
      csv.push(cols.join(","));
    }
    const csvBlob = new Blob([csv.join("\n")], { type: 'text/csv' });
    const url = URL.createObjectURL(csvBlob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "submissions.csv";
    a.click();
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>
